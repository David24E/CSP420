(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{140:function(e,t,n){},176:function(e,t){},178:function(e,t){},188:function(e,t,n){},190:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),i=(n(140),n(124)),s=n(12),l=n(222),d=n(16),u=n(224),j=n(226),m=n(227),b=n(228),h=n(241),p=n(230),f=n(231),O=n(232),x=n(245),g=n(2),v=Object(l.a)({root:{minWidth:"100%",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},card:{minWidth:275,maxWidth:345},maxWidth:{width:"100%"},textFieldVSpacing:{marginTop:22}}),y=["Text Chat","Video Chat"],C=["Watch Together","Broadcast"],N=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).URL||"http://localhost:8000",S=function(e){var t=v(),n=Object(a.useState)(""),r=Object(d.a)(n,2),c=r[0],o=r[1],i=Object(a.useState)("".concat(C[0])),s=Object(d.a)(i,2),l=s[0],S=s[1],T=Object(a.useState)("".concat(y[0])),k=Object(d.a)(T,2),w=k[0],I=k[1],D=function(e){var t=e.target,n=t.value,a=t.name;"roomName"===a?(console.log("value"+n),o(n)):"roomComms"===a?(console.log("value and name "+n+" "+a),I(n)):"roomType"===a&&(console.log("value and name "+n+" "+a),S(n))};return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)("div",{className:t.root,children:Object(g.jsxs)(u.a,{className:t.card,children:[Object(g.jsx)(j.a,{title:"CoVideo"}),Object(g.jsx)(m.a,{}),Object(g.jsxs)("form",{noValidate:!0,autoComplete:"off",onSubmit:function(t){t.preventDefault();var n=Object(x.a)(),a={roomID:n,roomName:c,roomType:l,roomComms:w};fetch(N,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(a)}).then((function(e){return console.log(e.text())})).then((function(){e.history.push("/room/".concat(n))}))},children:[Object(g.jsxs)(b.a,{children:[Object(g.jsx)(h.a,{name:"roomName",fullWidth:!0,value:c,className:t.textFieldVSpacing,onChange:D,label:"Room Name",helperText:"Name the Room",autoFocus:!0,required:!0}),Object(g.jsx)(h.a,{name:"roomComms",select:!0,fullWidth:!0,value:w,className:t.textFieldVSpacing,onChange:D,label:"Room Comms",helperText:"Choose the Preferred Communication Mode",children:y.map((function(e){return Object(g.jsx)(p.a,{value:e,children:e},e)}))}),Object(g.jsx)(h.a,{name:"roomType",select:!0,fullWidth:!0,value:l,className:t.textFieldVSpacing,onChange:D,label:"Room Type",helperText:"Choose the Required Room Configuration",children:C.map((function(e){return Object(g.jsx)(p.a,{value:e,children:e},e)}))})]}),Object(g.jsx)(f.a,{children:Object(g.jsx)(O.a,{variant:"contained",color:"primary",className:t.maxWidth,type:"submit",disabled:!c,children:"Create room"})})]})]})})})},T=n(62),k=n(73),w=n(90),I=n(125),D=n(120),R=n.n(D),E=n(87),F=n.n(E),V=n(242),P=n(237),W=n(238),U=n(239),B=n(40),M=n(246),_=n(243),L=n(240),A=n(229),H=n(193),J=n(233),Y=n(234),q=n(235),z=n(122),K=n.n(z),G=n(121),Q=n.n(G),X=function(e){return Object(a.useEffect)((function(){console.log("userinroom ",e.usersInRoom),console.dir(e.usersInRoom)}),[]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("div",{children:Object(g.jsx)(O.a,{variant:"contained",color:"default",startIcon:Object(g.jsx)(Q.a,{}),disableElevation:!0,fullWidth:!0,children:"Add People"})}),Object(g.jsx)(A.a,{children:e.usersInRoom.map((function(e){return Object(g.jsxs)(H.a,{children:[Object(g.jsx)(J.a,{primary:e.nickname}),Object(g.jsx)(Y.a,{children:Object(g.jsx)(q.a,{edge:"end","aria-label":"delete",children:Object(g.jsx)(K.a,{})})})]},e.id)}))})]})},Z=n(123),$=n.n(Z),ee=n(236),te=Object(l.a)({message:{backgroundColor:"#aab6fe",margin:"4px 0px",padding:"0px 5px",borderRadius:"5px",width:"100%"},myMessage:{backgroundColor:"#d1d9ff",margin:"4px 0px",padding:"0px 5px",borderRadius:"5px",width:"100%"}}),ne=function(e){var t=te(),n={};return"mine"===e.messageType?(n.class=t.message,n.align="right"):"otherUser"===e.messageType&&(n.class=t.myMessage,n.align="left"),Object(g.jsx)(g.Fragment,{children:Object(g.jsx)("div",{className:n.class,children:Object(g.jsxs)(ee.a,{container:!0,children:[Object(g.jsx)(ee.a,{item:!0,xs:12,children:Object(g.jsx)(J.a,{align:n.align,secondary:Object(g.jsxs)(r.a.Fragment,{children:[Object(g.jsx)(B.a,{component:"span",variant:"body2",color:"primary",children:e.messageUser})," | ".concat(e.messageTime)]})})}),Object(g.jsx)(ee.a,{item:!0,xs:12,children:Object(g.jsx)(J.a,{align:n.align,children:e.children})})]})})})},ae=Object(l.a)({chatFormContainer:{position:"absolute",margin:"8px 0px",width:"89%",bottom:"0px",top:"auto"},chatForm:{marginTop:"8px"},textField:{width:"87%"},messageArea:{height:"70vh",overflowY:"auto"},message:{padding:"0px",margin:"0px"}}),re=function(e){var t=ae();return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(A.a,{className:t.messageArea,children:e.messages.map((function(n,a){return n.id===e.yourID?Object(g.jsx)(H.a,{className:t.message,children:Object(g.jsx)(ne,{messageType:"mine",messageUser:n.nickname,messageTime:"09:30",children:n.body})},a):Object(g.jsx)(H.a,{className:t.message,children:Object(g.jsx)(ne,{messageType:"otherUser",messageUser:n.nickname,messageTime:"09:31",children:n.body})},a)}))}),Object(g.jsxs)("div",{className:t.chatFormContainer,children:[Object(g.jsx)(m.a,{}),Object(g.jsxs)("form",{id:"chat-form",className:t.chatForm,onSubmit:e.sendMessage,noValidate:!0,autoComplete:"off",children:[Object(g.jsx)(h.a,{id:"msg",placeholder:"Enter Message",className:t.textField,value:e.message,onChange:e.handleChange,required:!0}),Object(g.jsx)(q.a,{id:"iconBtn",type:"submit",color:"primary","aria-label":"send Message",disabled:!e.message,children:Object(g.jsx)($.a,{})})]})]})]})},ce=Object(l.a)({vidWrapper:{display:"flex",flexWrap:"wrap",marginLeft:-0,marginTop:-0},vidContainer:{flex:"1 0 calc(50% - 0px)"},styledVideo:{width:"100%",height:"100%"},overlayContainer:{position:"relative"},overlay:{left:0,bottom:8,zIndex:1,opacity:.5,position:"absolute",backgroundColor:"black"},topText:{margin:1,color:"white",aligSelf:"center"}}),oe=function(e){var t=ce(),n=Object(a.useRef)();return Object(a.useEffect)((function(){e.peer&&e.peer.on("stream",(function(e){n.current.srcObject=e}))}),[]),Object(g.jsxs)("div",{className:t.vidContainer,children:[Object(g.jsx)("video",{className:t.styledVideo,playsInline:!0,autoPlay:!0,muted:!0,ref:n}),Object(g.jsx)("div",{className:t.overlayContainer,children:Object(g.jsx)("div",{className:t.overlay,children:Object(g.jsx)("p",{className:t.topText,children:e.nickname})})})]})},ie=function(e){var t=ce(),n=Object(a.useRef)();return Object(a.useEffect)((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){n.current&&(n.current.srcObject=e)}))}),[]),Object(g.jsxs)("div",{className:t.vidWrapper,children:[Object(g.jsxs)("div",{className:t.vidContainer,children:[Object(g.jsx)("video",{className:t.styledVideo,playsInline:!0,autoPlay:!0,muted:!0,ref:n}),Object(g.jsx)("div",{className:t.overlayContainer,children:Object(g.jsx)("div",{className:t.overlay,children:Object(g.jsx)("p",{className:t.topText,children:"You"})})})]}),e.peers.length>0?e.peers.map((function(e){return Object(g.jsx)(oe,{peer:e.peer,nickname:e.peerNickname},e.peerID)})):""]})},se=425,le=Object(l.a)((function(e){return{root:{minWidth:"100%",minHeight:"100vh"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:se,flexShrink:0},drawerPaper:{width:se},drawerContainer:{overflow:"auto"},content:{flexGrow:1,height:"100%",padding:e.spacing(3),width:"calc(100% - ".concat(se,"px)"),marginRight:se},paper:{width:400,position:"absolute",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),backgroundColor:e.palette.background.paper},modalButton:{right:-310,marginTop:22}}}));function de(){return{top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var ue=function(e){var t=e.children,n=e.value,a=e.index,r=Object(I.a)(e,["children","value","index"]);return Object(g.jsx)("div",Object(w.a)(Object(w.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(g.jsx)(V.a,{p:2,children:t})}))},je=function(e){var t=le(),n=r.a.useState(de),c=Object(d.a)(n,1)[0],o=Object(a.useRef)(),i=Object(a.useRef)([]),s=Object(a.useRef)(),l=Object(a.useRef)(),p=e.match.params.roomID,x=Object(a.useState)([]),v=Object(d.a)(x,2),y=(v[0],v[1]),C=Object(a.useState)(""),N=Object(d.a)(C,2),S=N[0],w=N[1],I=Object(a.useState)(),D=Object(d.a)(I,2),E=D[0],V=D[1],A=Object(a.useState)(""),H=Object(d.a)(A,2),J=H[0],Y=H[1],q=Object(a.useState)(""),z=Object(d.a)(q,2),K=z[0],G=z[1],Q=Object(a.useState)([]),Z=Object(d.a)(Q,2),$=Z[0],ee=Z[1],te=Object(a.useState)(0),ne=Object(d.a)(te,2),ae=ne[0],ce=ne[1],oe=Object(a.useState)([]),se=Object(d.a)(oe,2),je=se[0],me=se[1],be=Object(a.useState)(""),he=Object(d.a)(be,2),pe=he[0],fe=he[1],Oe=Object(a.useState)({roomName:"".concat(p),roomComms:"Text Chat",roomType:"Watch Together"}),xe=Object(d.a)(Oe,2),ge=xe[0],ve=xe[1],ye=Object(a.useState)(!1),Ce=Object(d.a)(ye,2),Ne=Ce[0],Se=Ce[1],Te=Object(a.useState)(!1),ke=Object(d.a)(Te,2),we=ke[0],Ie=ke[1];Object(a.useEffect)((function(){fetch("/room/".concat(p)).then((function(e){return e.json()})).then((function(e){console.log("data"+e),console.dir(e),ve(e)}))}),[p]),Object(a.useEffect)((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){o.current=R()({autoConnect:!1}),l.current&&(l.current.srcObject=e),o.current.on("all users",(function(t){var n=[];t.forEach((function(t){var a=function(e,t,n,a){var r=new F.a({initiator:!0,trickle:!1,stream:a});return r.on("signal",(function(a){o.current.emit("sending signal",{userToSignal:e,callerID:t,callerNickname:n,roomID:p,signal:a})})),r.on("data",Ee),r}(t.id,o.current.id,o.current.nickname,e);i.current.push({peerID:t.id,peerNickname:t.nickname,peer:a}),n.push({peerID:t.id,peerNickname:t.nickname,peer:a})})),y(n)})),o.current.on("user joined",(function(t){var n=function(e,t,n){var a=new F.a({initiator:!1,trickle:!1,stream:n});return a.on("signal",(function(e){o.current.emit("returning signal",{signal:e,callerID:t,roomID:p})})),a.on("data",Ee),a.signal(e),a}(t.signal,t.callerID,e);i.current.push({peerID:t.callerID,peerNickname:t.callerNickname,peer:n});var a={peerID:t.callerID,peerNickname:t.callerNickname,peer:n};y((function(e){return[].concat(Object(k.a)(e),[a])}))})),o.current.on("receiving returned signal",(function(e){i.current.find((function(t){return t.peerID===e.id})).peer.signal(e.signal)})),o.current.on("room full",(function(){alert("room is full")})),o.current.on("your id",(function(e){w(e)})),o.current.on("all users in room",(function(e){e.sort((function(e,t){return t.nickname-e.nickname})),e.some((function(t,n){return t.id===o.current.id&&e.unshift(e.splice(n,1)[0])}));var t=e.find((function(e){return e.id===o.current.id}));if(t&&(t.nickname="".concat(t.nickname,"(You)")),console.log("all users in room start users "),console.dir(je),console.log("all users in room start PeersRef "),console.dir(i),i.current.length>0){var n,a=Object(T.a)(e);try{var r=function(){var e=n.value,t=i.current.find((function(t){return!t.peerNickname&&t.peerID===e.id}));t&&(t.peerNickname=e.nickname)};for(a.s();!(n=a.n()).done;)r()}catch(c){a.e(c)}finally{a.f()}}console.log("all users in room end users "),console.dir(e),console.log("all users in room end PeersRef "),console.dir(i),me(e)})),o.current.on("message",(function(e){De(e)})),o.current.on("user left",(function(e){var t=i.current.find((function(t){return t.peerID===e}));console.log("user leaving... "),console.dir(t),t&&t.peer.destroy();var n=i.current.filter((function(t){return t.peerID!==e}));i.current=n,console.log("user left end PeersRef "),console.dir(i),console.log("user left end Peers "),console.dir(n),o.current.emit("all users in room"),y(n)}))}))}),[]),Object(a.useEffect)((function(){if(console.log("USE EFFECT LAUNCHED"),we){console.log("USE EFFECT LAUNCHED");var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),window.onYouTubeIframeAPIReady=Re}}),[we]);var De=function(e){ee((function(t){return[].concat(Object(k.a)(t),[e])})),console.log("receivedMessage ",$)};function Re(){var e=new window.YT.Player("player",{height:"390",width:"640"});s.current=e}function Ee(e){var t=JSON.parse(e);"newVideo"===t.type?s.current.loadVideoById(t.data.split("=")[1]):"pause"===t.type?s.current.pauseVideo():s.current.playVideo()}return Object(g.jsx)(g.Fragment,{children:E?Object(g.jsxs)("div",{className:t.root,children:[Object(g.jsx)(P.a,{}),Object(g.jsx)(W.a,{position:"fixed",className:t.appBar,children:Object(g.jsx)(U.a,{children:Object(g.jsx)(B.a,{variant:"h6",noWrap:!0,children:"CoVideo"})})}),Object(g.jsxs)("main",{className:t.content,children:[Object(g.jsx)(U.a,{}),Object(g.jsx)("div",{id:"player"}),Object(g.jsx)("br",{}),Object(g.jsx)("button",{onClick:function(){var e,t=Object(T.a)(i.current);try{for(t.s();!(e=t.n()).done;){e.value.peer.send(JSON.stringify({type:"pause"})),s.current.pauseVideo()}}catch(n){t.e(n)}finally{t.f()}},children:"Stop Video"}),Object(g.jsx)("button",{onClick:function(){var e,t=Object(T.a)(i.current);try{for(t.s();!(e=t.n()).done;){e.value.peer.send(JSON.stringify({type:"play"})),s.current.playVideo()}}catch(n){t.e(n)}finally{t.f()}},children:"Play Video"}),Object(g.jsx)("input",{type:"text",placeholder:"video link",value:K,onChange:function(e){return G(e.target.value)}}),Object(g.jsx)("button",{onClick:function(){var e,t=Object(T.a)(i.current);try{for(t.s();!(e=t.n()).done;){e.value.peer.send(JSON.stringify({type:"newVideo",data:K})),s.current.loadVideoById(K.split("=")[1])}}catch(n){t.e(n)}finally{t.f()}},children:"Load video"})]}),Object(g.jsx)(M.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper},anchor:"right",children:Object(g.jsxs)("div",{className:t.drawerContainer,children:[Object(g.jsx)(U.a,{}),Object(g.jsxs)(_.a,{value:ae,onChange:function(e,t){o.current.on("all users",(function(e){e.forEach((function(e){i.current=[].concat(Object(k.a)(i.current),[{id:e.id,nickname:e.nickname}])}))})),ce(t)},indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example",children:[Object(g.jsx)(L.a,{label:"Chat"}),Object(g.jsx)(L.a,{label:"People (".concat(je.length,")")})]}),Object(g.jsx)(ue,{value:ae,index:0,children:"Text Chat"===ge.roomComms?Object(g.jsx)(re,{messages:$,yourID:S,message:J,handleChange:function(e){Y(e.target.value)},sendMessage:function(e){e.preventDefault();var t={body:J,id:S,nickname:pe};Y(""),o.current.emit("send message",t)}}):Object(g.jsx)(ie,{peers:i.current})}),Object(g.jsx)(ue,{value:ae,index:1,children:Object(g.jsx)(X,{usersInRoom:je},je.length)})]})})]}):Object(g.jsxs)(u.a,{style:c,className:t.paper,children:[Object(g.jsx)(j.a,{title:"Please enter a username"}),Object(g.jsx)(m.a,{}),Object(g.jsxs)("form",{noValidate:!0,autoComplete:"off",onSubmit:function(e){e.preventDefault();var t={id:S,nickname:pe};o.current.connect(),o.current.emit("join room",{roomID:p,nickname:pe},(function(e){e?(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){l.current&&(l.current.srcObject=e)})),Ie(!0),V(t)):Se(!0)}))},children:[Object(g.jsx)(b.a,{children:Object(g.jsx)(h.a,{name:"username",fullWidth:!0,autoFocus:!0,value:pe,error:Ne,onChange:function(e){var t=e.target.value;fe(t)},label:"your username",helperText:Ne?"That username is not available. Please enter another":"",required:!0})}),Object(g.jsx)(f.a,{children:Object(g.jsx)(O.a,{variant:"contained",color:"primary",className:t.modalButton,type:"submit",disabled:!pe,children:"Done"})})]})]})})},me=(n(188),Object(l.a)({appRoot:{display:"flex",justifyContent:"center",minHeight:"100vh",flexDirection:"column",alignItems:"center"}}));var be=function(){var e=me();return Object(g.jsx)("div",{className:e.appRoot,children:Object(g.jsx)(i.a,{children:Object(g.jsxs)(s.c,{children:[Object(g.jsx)(s.a,{path:"/",exact:!0,component:S}),Object(g.jsx)(s.a,{path:"/room/:roomID",component:je})]})})})},he=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,249)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),c(e),o(e)}))};o.a.render(Object(g.jsx)(r.a.StrictMode,{children:Object(g.jsx)(be,{})}),document.getElementById("root")),he()}},[[190,1,2]]]);
//# sourceMappingURL=main.72dcb25d.chunk.js.map